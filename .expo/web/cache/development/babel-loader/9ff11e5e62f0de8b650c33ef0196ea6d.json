{"ast":null,"code":"import _extends from \"@babel/runtime/helpers/extends\";\nimport _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _inherits from \"@babel/runtime/helpers/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/getPrototypeOf\";\nvar _jsxFileName = \"/home/vic/reactnative/shop/AuthDemo.js\";\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React, { Component } from 'react';\nimport Text from \"react-native-web/dist/exports/Text\";\nimport View from \"react-native-web/dist/exports/View\";\nimport ActivityIndicator from \"react-native-web/dist/exports/ActivityIndicator\";\nimport LoginScreen from \"./components/LoginScreen\";\nimport { NavigationContainer } from '@react-navigation/native';\nimport { createStackNavigator } from '@react-navigation/stack';\nimport SignUpScreen from \"./components/SignUpScreen\";\nimport SignUpCompleted from \"./components/SignUpCompleted\";\nimport * as SecureStore from 'expo-secure-store';\nimport LoadingScreen from \"./components/LoadingScreen\";\nimport TodoApp from \"./components/TodoApp\";\nimport ProductItem from \"./components/ProductItem\";\nimport Home from \"./screens/Home\";\nvar Stack = createStackNavigator();\nvar secureStoreTokenName = \"demoAppJWT2\";\n\nvar AuthDemo = function (_Component) {\n  _inherits(AuthDemo, _Component);\n\n  var _super = _createSuper(AuthDemo);\n\n  function AuthDemo(_props) {\n    var _this;\n\n    _classCallCheck(this, AuthDemo);\n\n    _this = _super.call(this, _props);\n\n    _this.onLoginReceiveJWT = function (data) {\n      var responseJWT = data.token;\n      SecureStore.setItemAsync(secureStoreTokenName, responseJWT).then(function (response) {\n        console.log(response);\n\n        _this.setState({\n          activeJWT: responseJWT,\n          isCheckingTokenStorage: false,\n          userData: data\n        });\n      });\n    };\n\n    _this.authLogic = function () {\n      var authScreens = React.createElement(React.Fragment, null, React.createElement(Stack.Screen, {\n        name: \"Login\",\n        options: {\n          headerShown: false\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 55,\n          columnNumber: 9\n        }\n      }, function (props) {\n        return React.createElement(LoginScreen, _extends({}, props, {\n          onLoginReceiveJWT: _this.onLoginReceiveJWT,\n          apiURI: _this.props.apiURI,\n          onLoginReceiveName: _this.onLoginReceiveName,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 61,\n            columnNumber: 22\n          }\n        }));\n      }), React.createElement(Stack.Screen, {\n        name: \"Signup\",\n        options: {\n          headerShown: false\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 65,\n          columnNumber: 9\n        }\n      }, function (props) {\n        return React.createElement(SignUpScreen, _extends({}, props, {\n          apiURI: _this.props.apiURI,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 71,\n            columnNumber: 22\n          }\n        }));\n      }), React.createElement(Stack.Screen, {\n        name: \"SignupCompleted\",\n        options: {\n          headerShown: false\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 73,\n          columnNumber: 9\n        }\n      }, function (props) {\n        return React.createElement(SignUpCompleted, _extends({}, props, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 79,\n            columnNumber: 22\n          }\n        }));\n      }), React.createElement(Stack.Screen, {\n        name: \"ProductItem\",\n        options: {\n          headerShown: false\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 81,\n          columnNumber: 9\n        }\n      }, function (props) {\n        return React.createElement(ProductItem, _extends({}, props, {\n          apiURI: _this.props.apiURI,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 87,\n            columnNumber: 22\n          }\n        }));\n      }), React.createElement(Stack.Screen, {\n        name: \"Home\",\n        options: {\n          headerShown: false\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 89,\n          columnNumber: 9\n        }\n      }, function (props) {\n        return React.createElement(Home, _extends({}, props, {\n          apiURI: _this.props.apiURI,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 95,\n            columnNumber: 22\n          }\n        }));\n      }));\n      var app = React.createElement(Stack.Screen, {\n        name: \"TodoApp\",\n        options: {\n          headerShown: false\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 101,\n          columnNumber: 7\n        }\n      }, function (props) {\n        return React.createElement(TodoApp, _extends({}, props, {\n          jwt: _this.state.activeJWT,\n          apiURI: _this.props.apiURI,\n          onLogout: _this.onLogout,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 106,\n            columnNumber: 22\n          }\n        }));\n      });\n      var checkingForTokenStorage = React.createElement(Stack.Screen, {\n        name: \"Loading\",\n        component: LoadingScreen,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 118,\n          columnNumber: 7\n        }\n      });\n\n      if (_this.state.isCheckingTokenStorage) {\n        console.log('Checking is token stored');\n        return checkingForTokenStorage;\n      } else {\n        if (_this.state.activeJWT != null) {\n          console.log('JWT Token found, displaying application logged in views');\n          return app;\n        } else {\n          console.log('JWT Token not found, displaying application authentication views');\n          return authScreens;\n        }\n      }\n\n      console.error('Incorrect authLogic function processing');\n    };\n\n    _this.onLogout = function () {\n      console.log(\"Logout clicked\");\n\n      _this.setState({\n        activeJWT: null\n      });\n\n      SecureStore.deleteItemAsync(secureStoreTokenName);\n    };\n\n    _this.state = {\n      isCheckingTokenStorage: true,\n      activeJWT: null,\n      userData: null\n    };\n    return _this;\n  }\n\n  _createClass(AuthDemo, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this2 = this;\n\n      SecureStore.getItemAsync(secureStoreTokenName).then(function (response) {\n        console.log(\"SecureStore.getItemAsync success\");\n\n        _this2.setState({\n          activeJWT: response,\n          isCheckingTokenStorage: false\n        });\n      }).catch(function (error) {\n        console.log(\"SecureStore.getItemAsync error\");\n        console.log(error);\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      return React.createElement(View, {\n        style: {\n          flex: 1\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 150,\n          columnNumber: 7\n        }\n      }, React.createElement(NavigationContainer, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 151,\n          columnNumber: 9\n        }\n      }, React.createElement(Stack.Navigator, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 152,\n          columnNumber: 11\n        }\n      }, this.authLogic())));\n    }\n  }]);\n\n  return AuthDemo;\n}(Component);\n\nexport { AuthDemo as default };","map":{"version":3,"sources":["/home/vic/reactnative/shop/AuthDemo.js"],"names":["React","Component","LoginScreen","NavigationContainer","createStackNavigator","SignUpScreen","SignUpCompleted","SecureStore","LoadingScreen","TodoApp","ProductItem","Home","Stack","secureStoreTokenName","AuthDemo","props","onLoginReceiveJWT","data","responseJWT","token","setItemAsync","then","response","console","log","setState","activeJWT","isCheckingTokenStorage","userData","authLogic","authScreens","headerShown","apiURI","onLoginReceiveName","app","state","onLogout","checkingForTokenStorage","error","deleteItemAsync","getItemAsync","catch","flex"],"mappings":"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","sourcesContent":["import React, { Component } from 'react'\nimport { Text, View, ActivityIndicator } from 'react-native'\nimport LoginScreen from './components/LoginScreen'\nimport { NavigationContainer } from '@react-navigation/native'\nimport { createStackNavigator } from '@react-navigation/stack'\nimport SignUpScreen from './components/SignUpScreen'\nimport SignUpCompleted from './components/SignUpCompleted'\nimport * as SecureStore from 'expo-secure-store'\nimport LoadingScreen from './components/LoadingScreen'\nimport TodoApp from './components/TodoApp'\nimport ProductItem from './components/ProductItem'\nimport Home from './screens/Home'\n\nconst Stack = createStackNavigator();\nconst secureStoreTokenName = \"demoAppJWT2\";\n\nexport default class AuthDemo extends Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      isCheckingTokenStorage: true,\n      activeJWT: null,\n      userData: null\n    };\n  }\n\n  componentDidMount() {\n    // Check for stored JWT when the application loads\n    SecureStore.getItemAsync(secureStoreTokenName)\n      .then(response => {\n        console.log(\"SecureStore.getItemAsync success\")        \n        this.setState({ activeJWT: response, isCheckingTokenStorage: false })\n      })\n      .catch(error => {\n        console.log(\"SecureStore.getItemAsync error\")\n        console.log(error);\n      });\n  }\n\n  \n  onLoginReceiveJWT = (data) => {\n    const responseJWT = data.token\n    // Deal with successful login by storing the token into secure store\n    SecureStore.setItemAsync(secureStoreTokenName, responseJWT)\n      .then(response => {\n        console.log(response);\n        this.setState({ activeJWT: responseJWT, isCheckingTokenStorage: false, userData: data })\n      })    \n  }\n\n  authLogic = () => {\n    const authScreens = (\n      <>\n        <Stack.Screen\n          name=\"Login\"\n          options={{\n            headerShown: false,\n          }}\n        >\n          { props => <LoginScreen {...props} onLoginReceiveJWT={ this.onLoginReceiveJWT }\n                                             apiURI={ this.props.apiURI }\n                                             onLoginReceiveName={this.onLoginReceiveName}></LoginScreen> }\n        </Stack.Screen>\n        <Stack.Screen\n          name=\"Signup\"\n          options={{\n            headerShown: false,\n          }}\n        >\n          { props => <SignUpScreen {...props} apiURI={ this.props.apiURI }></SignUpScreen>}\n        </Stack.Screen>\n        <Stack.Screen\n          name=\"SignupCompleted\"\n          options={{\n            headerShown: false,\n          }}\n        >\n          { props => <SignUpCompleted {...props}></SignUpCompleted>}\n        </Stack.Screen>\n        <Stack.Screen\n          name=\"ProductItem\"\n          options={{\n            headerShown: false,\n          }}\n        >\n          { props => <ProductItem {...props} apiURI={ this.props.apiURI }></ProductItem>}\n        </Stack.Screen>\n        <Stack.Screen\n          name=\"Home\"\n          options={{\n            headerShown: false,\n          }}\n        >\n          { props => <Home {...props} apiURI={ this.props.apiURI }></Home>}\n        </Stack.Screen>\n      </>\n    );\n\n    const app = (\n      <Stack.Screen \n        name=\"TodoApp\" \n        options={{\n          headerShown: false,\n        }}>\n          { props => <TodoApp \n                        {...props} \n                        jwt={ this.state.activeJWT } \n                        apiURI={ this.props.apiURI }\n                        onLogout={ this.onLogout }\n                      ></TodoApp>}\n      </Stack.Screen>\n    )\n\n    \n\n    const checkingForTokenStorage = (\n      <Stack.Screen name=\"Loading\" component={LoadingScreen} />\n    )\n\n    if(this.state.isCheckingTokenStorage)\n    {\n      console.log('Checking is token stored');\n      return checkingForTokenStorage;\n    }\n    else\n    {\n      if(this.state.activeJWT != null)\n      {\n        console.log('JWT Token found, displaying application logged in views');\n        return app;\n      }\n      else\n      {\n        console.log('JWT Token not found, displaying application authentication views');\n        return authScreens;\n      }\n    }\n    console.error('Incorrect authLogic function processing');\n  }\n\n  onLogout = () => {\n    console.log(\"Logout clicked\");\n    this.setState({ activeJWT: null });\n    SecureStore.deleteItemAsync(secureStoreTokenName);\n  }\n\n  render() {\n    return (\n      <View style={{ flex: 1}}>\n        <NavigationContainer>\n          <Stack.Navigator>\n            { this.authLogic() }\n          </Stack.Navigator>\n        </NavigationContainer>\n      </View>\n    )\n  }\n}\n"]},"metadata":{},"sourceType":"module"}